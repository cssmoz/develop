var postTitle=new Array,postUrl=new Array,postDate=new Array,postSum=new Array,postLabels=new Array,sortBy="datenewest",tocLoaded=!1,numChars=250,postFilter="",tocdiv=document.getElementById("bp_toc"),totalEntires=0,totalPosts=0;function loadtoc(t){!function(){if("entry"in t.feed){var e=t.feed.entry.length;if(totalEntires+=e,(totalPosts=t.feed.openSearch$totalResults.$t)>totalEntires){var s=document.createElement("script");s.type="text/javascript",startindex=totalEntires+1,s.setAttribute("src","/feeds/posts/summary?start-index="+startindex+"&max-results=500&alt=json-in-script&callback=loadtoc"),tocdiv.appendChild(s)}for(var o=0;o<e;o++){for(var l,a=t.feed.entry[o],r=a.title.$t,i=a.published.$t.substring(0,10),n=0;n<a.link.length;n++)if("alternate"==a.link[n].rel){l=a.link[n].href;break}if("content"in a)var c=a.content.$t;else c="summary"in a?a.summary.$t:"";if((c=c.replace(/<\S[^>]*>/g,"")).length>numChars){var p=(c=c.substring(0,numChars)).lastIndexOf(" ");c=c.substring(0,p)+"..."}var d="";if("category"in a){for(n=0;n<a.category.length;n++)d+="<a href=\"javascript:filterPosts('"+a.category[n].term+"');\" title=\"Click here to select all posts with label '"+a.category[n].term+"'\">"+a.category[n].term+"</a>,  ";var f=d.lastIndexOf(",");-1!=f&&(d=d.substring(0,f))}postTitle.push(r),postDate.push(i),postUrl.push(l),postSum.push(c),postLabels.push(d)}}totalEntires==totalPosts&&(tocLoaded=!0,showToc())}(),sortPosts(sortBy),tocLoaded=!0}function filterPosts(t){displayToc(postFilter=t)}function allPosts(){displayToc(postFilter="")}function sortPosts(t){function e(t,e){var s=postTitle[t];postTitle[t]=postTitle[e],postTitle[e]=s;s=postDate[t];postDate[t]=postDate[e],postDate[e]=s;s=postUrl[t];postUrl[t]=postUrl[e],postUrl[e]=s;s=postSum[t];postSum[t]=postSum[e],postSum[e]=s;s=postLabels[t];postLabels[t]=postLabels[e],postLabels[e]=s}for(var s=0;s<postTitle.length-1;s++)for(var o=s+1;o<postTitle.length;o++)"titleasc"==t&&postTitle[s]>postTitle[o]&&e(s,o),"titledesc"==t&&postTitle[s]<postTitle[o]&&e(s,o),"dateoldest"==t&&postDate[s]>postDate[o]&&e(s,o),"datenewest"==t&&postDate[s]<postDate[o]&&e(s,o)}function displayToc(t){var e=0,s="",o="Click to sort by title",l="Click to sort by date",a="";"titleasc"==sortBy&&(o+=" (descending)",l+=" (newest first)"),"titledesc"==sortBy&&(o+=" (ascending)",l+=" (newest first)"),"dateoldest"==sortBy&&(o+=" (ascending)",l+=" (newest first)"),"datenewest"==sortBy&&(o+=" (ascending)",l+=" (oldest first)"),""!=postFilter&&(a="Click to show all posts"),s+="<table>",s+="<tr>",s+='<td class="toc-header-col1">',s+='<a href="javascript:toggleTitleSort();" title="'+o+'">POST TITLE</a>',s+="</td>",s+='<td class="toc-header-col2">',s+='<a href="javascript:toggleDateSort();" title="'+l+'">POST DATE</a>',s+="</td>",s+='<td class="toc-header-col3">',s+='<a href="javascript:allPosts();" title="'+a+'">LABELS</a>',s+="</td>",s+="</tr>";for(var r=0;r<postTitle.length;r++)""==t?(s+='<tr><td class="toc-entry-col1"><a href="'+postUrl[r]+'" title="'+postSum[r]+'">'+postTitle[r]+'</a></td><td class="toc-entry-col2">'+postDate[r]+'</td><td class="toc-entry-col3">'+postLabels[r]+"</td></tr>",e++):(z=postLabels[r].lastIndexOf(t),-1!=z&&(s+='<tr><td class="toc-entry-col1"><a href="'+postUrl[r]+'" title="'+postSum[r]+'">'+postTitle[r]+'</a></td><td class="toc-entry-col2">'+postDate[r]+'</td><td class="toc-entry-col3">'+postLabels[r]+"</td></tr>",e++));if(s+="</table>",e==postTitle.length)var i='<span class="toc-note">Displaying all '+postTitle.length+" posts<br/></span>";else{i='<span class="toc-note">Displaying '+e+" posts labeled '";i+=postFilter+"' of "+postTitle.length+" posts total<br/></span>"}tocdiv.innerHTML=i+s}function toggleTitleSort(){sortPosts(sortBy="titleasc"==sortBy?"titledesc":"titleasc"),displayToc(postFilter)}function toggleDateSort(){sortPosts(sortBy="datenewest"==sortBy?"dateoldest":"datenewest"),displayToc(postFilter)}function showToc(){if(tocLoaded){displayToc(postFilter);document.getElementById("toclink")}else alert("Just wait... TOC is loading")}function hideToc(){document.getElementById("toc").innerHTML="",document.getElementById("toclink").innerHTML='<a href="#" onclick="scroll(0,0); showToc(); Effect.toggle(\'toc-result\',\'blind\');">Â» Show Table of Contents</a> <img src="http://chenkaie.blog.googlepages.com/new_1.gif"/>'}
